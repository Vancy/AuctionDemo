<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="utils.html">

<polymer-element name="auction-login-box">
  <template>
    <link rel="stylesheet" href="./auction-login-box.css" type="text/css" />

    <!-- Get l -->
    <core-ajax
      auto
      url="http://jsonip.com"
      handleAs="json"
      on-core-response="{{ getIP }}"
    ></core-ajax>

     
    <core-ajax
      id="submit"
      url="{{ requestUrl }}"
      handleAs="xml"
      on-core-response="{{ handleResponse }}"
    ></core-ajax>

    <div id="auction-login-box">
      <div class="title">
        <p>Auction System</p>
      </div>
      <div id="box">
        <p id="login_tips" class="login_tips"></p>
        <div>
          <input type="text" id="name" value="{{ username }}" placeholder="please enter your name" autofocus/>
          <label for="name"><i>Enter your name</i></lable>
        </div>
        
        <div id="div-btn-login">
          <button class="btn"  id="btn-login" on-click="{{onClick}}">Enter</button>
          <span>{{ localIP }}</span>
        </div>
        
    </div>



  </template>

  <script>
    Polymer('auction-login-box', {
      localIP : "127.0.0.1",
      username : "",
      requestUrl : "",

      getIP: function(e) {
        this.localIP = e.detail.response.ip;
        this.requestUrl = "/WEB-INF/login.xml?name=" + this.username + "&ip=" + this.localIP;
      },

      handleResponse: function(e) {
        var xml = e.detail.xhr.response; 
        this.switchTo(xml);
      },

      onClick: function() {
        console.log("on-click", this.requestUrl);
        this.$.submit.go();
      },

      switchTo: function(xml) {
        var x2js = new X2JS();
        var json = x2js.xml_str2json(xml);

        var type = json.auction_context.type._value;
        if ( type == "SAA" ) {
          var saa = document.querySelector("#saa");
          saa.hidden = false;
          this.hidden = true;
          saa.getData(json);
        } else if ( type == "CCA" ) {

        } else {

        }
      },

      // domReady: function() {
      //   var saa = document.querySelector("#saa");
      //   console.log(saa);
      // }

    });
  </script>
</polymer-element>